<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script   src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"   integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="   crossorigin="anonymous"></script>
  <!-- Date handling lib -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/luisfarzati/moment-interval/master/src/moment-interval.js"></script>
  
  <!-- iCal parsing -->
  <script type="text/javascript" src="./js/ijp.js"></script>
  <!-- recurrence parsing -->
  <script type="text/javascript" src="./js/rrule.js"></script>
  <script type="text/javascript" src="./js/nlp.js"></script>

  <!-- App lib -->
  <script type="text/javascript" src="./js/slider.js"></script>

  <!-- UI niceness -->
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/blitzer/jquery-ui.css"/>
  
  <link rel="stylesheet" href="css/slides.css"/>
  

  <title>Event slides</title>




<body>
    <section id="messages"></section>
	<fieldset>
		<label for="start_date">Dates</label>
		<input type="date" id="start_date"/>
		-
		<input type="date" id="end_date"/>
	</fieldset>
	<fieldset>
		<label for="template">Theme</label>
		<select id="template" name="template" class="thumbnail">
			<option value="plain" data-style="background-image: none;">Plain</option>
			<option value="blue_flowers" data-style="background-image: url(&apos;images/blue_flowers.jpg&apos;);">Blue flowers</option>
			<option value="brown_vintage" data-style="background-image: url(&apos;images/brown_vintage.jpg&apos;);">Brown vintage</option>
			<option value="paisly_on_black" data-style="background-image: url(&apos;images/paisly_on_black.jpg&apos;);">Paisly on black</option>
		</select>
	</fieldset>
	<fieldset>
		<label for="file">Select iCal file:</label>
		<input id="file" type="file" name="file" onchange="fileChanged(event)" class="ui-widget"/>
	</fieldset>
	<section id="output"></section>
    <footer id="info">
		Click slide to download as image
    </footer>
  <script>
	  // Renderer for theme menu
	  $.widget( "custom.iconselectmenu", $.ui.selectmenu, {
      _renderItem: function( ul, item ) {
        var li = $( "<li>" ),
          wrapper = $( "<div>", { text: item.label } );

        if ( item.disabled ) {
          li.addClass( "ui-state-disabled" );
        }

        $( "<span>", {
          style: item.element.attr( "data-style" ),
          "class": "ui-icon " + item.element.attr( "data-class" )
        })
          .appendTo( wrapper );

        return li.append( wrapper ).appendTo( ul );
      }
    });

	/**
	 * Load & parse a local iCal file
	 */
	function fileChanged(event) {
		jQuery('#output').empty();
		for(var i = 0; i < event.target.files.length; i++)
		{
			var file = event.target.files[i];
			SlideMaker.makeSlides(file,
				moment(jQuery('#start_date').val()),
				moment(jQuery('#end_date').val())
			);
		}
	}

	 jQuery(document).ready(function() {
		 		// Read anything set in query
		var $_GET = {};
		if(document.location.toString().indexOf('?') !== -1) {
			var query = document.location
						   .toString()
						   // get the query string
						   .replace(/^.*?\?/, '')
						   // and remove any existing hash string (thanks, @vrijdenker)
						   .replace(/#.*$/, '')
						   .split('&');

			for(var i=0, l=query.length; i<l; i++) {
			   var aux = decodeURIComponent(query[i]).split('=');
			   $_GET[aux[0]] = aux[1];
			}
		}

		// initialize dates & theme
		var start = $_GET.from ? moment($_GET.from) : moment().startOf('week').add(1,'w');
		var end = $_GET.to ? moment($_GET.to) : moment(start).endOf('week').add(1,'w');
		jQuery('#start_date').val(start.format('YYYY-MM-DD'));
		jQuery('#end_date').val(end.format('YYYY-MM-DD'));
		if($_GET.template)
		{
			jQuery('#template').val($_GET.template);
			SlideMaker.setTemplate($_GET.template);
		}
		
		jQuery('#template').iconselectmenu({
			change: function() {
				jQuery('#output').empty();
				SlideMaker.setTemplate(this.value);
				var file_node = jQuery('#file')[0];
				if(file_node && file_node.files && file_node.files.length)
				{
					for(var i = 0; i < file_node.files.length; i++)
					{
						var file = file_node.files[i];
						SlideMaker.makeSlides(file,
							moment(jQuery('#start_date').val()),
							moment(jQuery('#end_date').val())
						);
					}
				}
			}
		})
			.iconselectmenu()
			.iconselectmenu( "menuWidget" )
			.addClass( "ui-menu-icons thumbnail" );

		// Tell it where to put messages
		SlideMaker.setMessageNode(document.getElementById('messages'));
	});
</script>


</body></html>
